names:
  service: zendesk-mcp-server
  github: zendesk-mcp-server

build:
  allow_vulnerable_image: true
  allow_vulnerable_code: true
  allow_secret_plaintext: true
  use_vault_ha: true

project:
  squad: ai.integrations.squad
  primary_maintainer: dillin
  secondary_maintainer: ciaranp
  public_api: false
  private_api: true

autoscaling:
  minInstances: 1
  maxInstances: 1
  averageMemory: 200
  averageCpu: 50

deploy:
  cpu: 100
  cpu_limit: 200
  memory: 300
  memory_limit: 600
  k8s_clusters: ["backend-ch1-prod"]
  node_profile: generic
  secrets_from: file
  instances: 2
  service:
    - name: zendesk-mcp-server
      port: 3000
      tags: ["metrics"]

alerts:
  HostInstanceDown:
    description: "The number of available instances is less than the expected amount."
    destination: "opsgenie"
    prometheus_expression: 'sum(kube_deployment_status_replicas_unavailable{job="kube-state-metrics",deployment="zendesk-mcp-server"}) > 0'
    prometheus_for: "5m"
    resolution_document: "https://app.getguru.com/card/cp45qLbi/Zendesk-MCP-Server-Alerts"
  HostMemoryHalf:
    description: "Host has reached 60% memory capacity."
    destination: "opsgenie"
    prometheus_expression: max(container_memory_usage_bytes{pod=~"zendesk-mcp-server(-.{1,10}-.{1,10})$",container!="",container!="POD",container=~".*zendesk-mcp-server.*"}) / max(kube_pod_container_resource_limits{resource="memory",unit="byte",job="kube-state-metrics",container=~"zendesk-mcp-server",pod=~"zendesk-mcp-server-.*"}) > 0.60
    prometheus_for: "5m"
    resolution_document: "https://app.getguru.com/card/cp45qLbi/Zendesk-MCP-Server-Alerts"
  HostOutOfMemory:
    description: "Host has reached 80% memory capacity. Less than 20% available."
    destination: "opsgenie"
    prometheus_expression: max(container_memory_usage_bytes{pod=~"zendesk-mcp-server(-.{1,10}-.{1,10})$",container!="",container!="POD",container=~".*zendesk-mcp-server.*"}) / max(kube_pod_container_resource_limits{resource="memory",unit="byte",job="kube-state-metrics",container=~"zendesk-mcp-server",pod=~"zendesk-mcp-server-.*"}) > 0.80
    prometheus_for: "5m"
    resolution_document: "https://app.getguru.com/card/cp45qLbi/Zendesk-MCP-Server-Alerts"
  HostOutOfCPU:
    description: "Host has reached 80% CPU usage. Less than 20% available."
    destination: "opsgenie"
    prometheus_expression: (sum(kube_metrics_server_pods_cpu{pod_name=~"zendesk-mcp-server(-.{1,10}-.{1,10})$",pod_container_name=~"zendesk-mcp-server"}) by (pod_name,pod_container_name) / 1000000) > 80
    prometheus_for: "5m"
    resolution_document: "https://app.getguru.com/card/cp45qLbi/Zendesk-MCP-Server-Alerts"
